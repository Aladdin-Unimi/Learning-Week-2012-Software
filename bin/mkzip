#!/bin/bash

# Copyright (C) 2012 Massimo Santini <massimo.santini@unimi.it>
#
# This file is part of Learning-Week-2012-Software (lw12).
# 
# Learning-Week-2012-Software is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or (at your
# option) any later version.
# 
# Learning-Week-2012-Software is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the GNU General
# Public License for more details.
# 
# You should have received a copy of the GNU General Public License along with
# Learning-Week-2012-Software If not, see <http://www.gnu.org/licenses/>.

find lw -name \*.pyc -exec rm {} \;
rm -f lw*.zip code*.zip data*.zip
cd lw
zip -r ../lw.zip * >/dev/null
cd ../code
zip -r ../code.zip * >/dev/null
if [ ! -d ../data ]; then
mkdir ../data
fi
cd ../data
zip -r ../data.zip . -i * >/dev/null 
cd ..

if [ ! -z "$1" ]; then
	ver="v$(grep __version__ lw/lwf/__init__.py | cut -d"'" -f2)"
	for f in lw code; do
		vf="${f}-${ver}.zip"
		ln -sf $f.zip $vf
		./bin/dm Aladdin-Unimi Learning-Week-2012-Software $vf $ver
	done
fi
